(()=>{"use strict";var e=function(e,t,r){r.checkValidity()?(e.classList.remove(t),e.disabled=!1):(e.classList.add(t),e.disabled="disabled")},t=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&n(t)}};function r(e){e.classList.add("popup_opened"),document.addEventListener("keydown",t)}function n(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",t)}var o=function(e,t){var r=e.querySelectorAll(t.inputErrorMsgSelector),n=e.querySelectorAll(t.inputSelector);r.forEach((function(e){return e.textContent=""})),n.forEach((function(e){return e.classList.remove(t.inputErrorClass)}))},c={baseUrl:"https://nomoreparties.co/v1/plus-cohort-13/",headers:{authorization:"c31c5761-df9a-41b0-b471-54cb40593368","Content-Type":"application/json; charset=UTF-8"}},a=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function i(e){console.log(e)}function l(e){return fetch("".concat(c.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:c.headers,body:JSON.stringify()}).then(a)}function u(e,t){return fetch("".concat(c.baseUrl,"/cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:c.headers}).then(a)}var s=document.querySelector("#popup_image-open"),d=s.querySelector(".popup__image"),f=s.querySelector(".popup__caption");function p(e,t){return e.some((function(e){return e._id===t}))}function m(e,t,r,n,o,c){e(t,r)?n.classList.add(o):n.classList.remove(o),c.textContent=t.length}function v(e,t,n,o,c){var a=function(e,t,n,o){var c=document.querySelector(t.templateSelector).content.querySelector(t.cardElementSelector).cloneNode(!0),a=c.querySelector(t.cardTitleSelector),v=c.querySelector(t.cardImgSelector),y=c.querySelector(t.cardLikeSelector),S=c.querySelector(t.likeCounterSelector),h=c.querySelector(t.cardDeleteSelector);return a.textContent=e.name,v.setAttribute("src",e.link),v.setAttribute("alt",e.name),m(p,e.likes,n,y,t.likeActiveClass,S),n===o?h.addEventListener("click",(function(){l(e._id).then((function(){return c.remove()})).catch(i)})):h.classList.add(t.deleteButtonHiddenClass),y.addEventListener("click",(function(){var r=y.classList.contains(t.likeActiveClass);u(e._id,r).then((function(e){m(p,e.likes,n,y,t.likeActiveClass,S)})).catch(i)})),v.addEventListener("click",(function(){d.setAttribute("src",e.link),d.setAttribute("alt",e.name),f.textContent=e.name,r(s)})),c}(t,n,o,c);e.prepend(a)}function y(e){(e.target.classList.contains("popup__close-button")||e.target.classList.contains("popup_opened"))&&n(e.target.closest(".popup"))}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}var h=document.querySelector(".profile"),_=h.querySelector(".profile__name"),b=h.querySelector(".profile__desc"),q=h.querySelector(".profile__avatar"),E=h.querySelector(".profile__edit-button"),C=document.querySelector("#popup_profile-edit"),k=C.querySelector(".form[name=profile-edit]"),L=k.querySelector("#profile-name"),g=k.querySelector("#profile-desc"),A=k.querySelector(".form__button"),x=h.querySelector(".profile__avatar-edit-button"),T=document.querySelector("#popup_avatar-edit"),U=T.querySelector("form[name=avatar-edit]"),B=U.querySelector("#avatar-link"),D=U.querySelector(".form__button"),w=h.querySelector(".profile__add-button"),O=document.querySelector("#popup_place-add"),j=O.querySelector(".form[name=place-add]"),P=j.querySelector("#place-name"),I=j.querySelector("#place-link"),M=j.querySelector(".form__button"),N=document.querySelector(".places__grid"),H=document.querySelectorAll(".popup"),J={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inputErrorMsgSelector:".form__input-error",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__input_invalid"},z={templateSelector:"#place-template",cardElementSelector:".place",cardTitleSelector:".place__name",cardImgSelector:".place__photo",cardLikeSelector:".place__like-button",cardDeleteSelector:".place__delete-button",likeActiveClass:"place__like-button_active",likeCounterSelector:".place__like-counter",deleteButtonHiddenClass:"place__delete-button_hidden"},F="";function V(e,t){_.textContent=e,b.textContent=t}function $(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Сохранить";t.textContent=e?"Сохранение...":r}function G(t,r,o,c){n(t),r.reset(),e(o,c,r)}Promise.all([fetch("".concat(c.baseUrl,"/users/me"),{headers:c.headers}).then(a),fetch("".concat(c.baseUrl,"/cards"),{headers:c.headers}).then(a)]).then((function(e){var t,r,n,o,c,a=(c=2,function(e){if(Array.isArray(e))return e}(o=e)||function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,o,c=[],a=!0,i=!1;try{for(r=r.call(e);!(a=(n=r.next()).done)&&(c.push(n.value),!t||c.length!==t);a=!0);}catch(e){i=!0,o=e}finally{try{a||null==r.return||r.return()}finally{if(i)throw o}}return c}}(o,c)||function(e,t){if(e){if("string"==typeof e)return S(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?S(e,t):void 0}}(o,c)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=a[0],l=a[1];F=i._id,t=i.name,r=i.about,n=i.avatar,V(t,r),q.setAttribute("src",n),l.forEach((function(e){v(N,e,z,F,e.owner._id)}))})).catch(i),E.addEventListener("click",(function(){L.value=_.textContent,g.value=b.textContent,o(k,J),r(C)})),w.addEventListener("click",(function(){o(j,J),r(O)})),x.addEventListener("click",(function(){o(U,J),r(T)})),j.addEventListener("submit",(function(e){var t,r;e.preventDefault(),$(!0,M,"Создать"),(t=P.value,r=I.value,fetch("".concat(c.baseUrl,"/cards"),{method:"POST",headers:c.headers,body:JSON.stringify({name:t,link:r})}).then(a)).then((function(e){v(N,e,z,F,F),G(O,j,M,J.inactiveButtonClass)})).catch(i).finally((function(){$(!1,M,"Создать")}))})),k.addEventListener("submit",(function(e){var t,r;e.preventDefault(),$(!0,A),(t=L.value,r=g.value,fetch("".concat(c.baseUrl,"/users/me"),{method:"PATCH",headers:c.headers,body:JSON.stringify({name:t,about:r})}).then(a)).then((function(e){V(e.name,e.about),G(C,k,A,J.inactiveButtonClass)})).catch(i).finally((function(){$(!1,A)}))})),U.addEventListener("submit",(function(e){var t;e.preventDefault(),$(!0,D),(t=B.value,fetch("".concat(c.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:c.headers,body:JSON.stringify({avatar:t})}).then(a)).then((function(e){q.setAttribute("src",e.avatar),G(T,U,D,J.inactiveButtonClass)})).catch(i).finally((function(){$(!1,D)}))})),H.forEach((function(e){e.addEventListener("click",y)})),function(t){document.querySelectorAll(t.formSelector).forEach((function(r){!function(t,r){var n=t.querySelectorAll(r.inputSelector),o=t.querySelector(r.submitButtonSelector);t.addEventListener("submit",(function(e){e.preventDefault()})),e(o,r.inactiveButtonClass,t),n.forEach((function(n){n.addEventListener("input",(function(c){!function(e,t,r){var n=t.validity.valid,o=e.querySelector("#".concat(t.id,"-error"));n?function(e,t,r){t.textContent=e.validationMessage,e.classList.remove(r)}(t,o,r):function(e,t,r){t.textContent=e.validationMessage,e.classList.add(r)}(t,o,r)}(t,n,r.inputErrorClass),e(o,r.inactiveButtonClass,t)}))}))}(r,t)}))}(J)})();