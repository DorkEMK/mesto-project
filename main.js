(()=>{"use strict";var e=function(e,t,n){n.checkValidity()?(e.classList.remove(t),e.disabled=!1):(e.classList.add(t),e.disabled="disabled")},t=function(e){if("Escape"===e.key){var t=document.querySelector(".popup_opened");t&&r(t)}};function n(e){e.classList.add("popup_opened"),document.addEventListener("keydown",t)}function r(e){e.classList.remove("popup_opened"),document.removeEventListener("keydown",t)}var o={baseUrl:"https://nomoreparties.co/v1/plus-cohort-13/",headers:{authorization:"c31c5761-df9a-41b0-b471-54cb40593368","Content-Type":"application/json; charset=UTF-8"}},c=function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))};function a(e){console.log(e)}function i(e){return fetch("".concat(o.baseUrl,"/cards/").concat(e),{method:"DELETE",headers:o.headers,body:JSON.stringify()}).then(c)}function l(e,t){return fetch("".concat(o.baseUrl,"/cards/likes/").concat(e),{method:t?"DELETE":"PUT",headers:o.headers}).then(c)}var u=document.querySelector("#popup_image-open"),s=u.querySelector(".popup__image"),d=u.querySelector(".popup__caption");function p(e,t){return e.some((function(e){return e._id===t}))}function f(e,t,n,r,o,c){e(t,n)?r.classList.add(o):r.classList.remove(o),c.textContent=t.length}function m(e,t,r,o,c){var m=function(e,t,r,o){var c=document.querySelector(t.templateSelector).content.querySelector(t.cardElementSelector).cloneNode(!0),m=c.querySelector(t.cardTitleSelector),v=c.querySelector(t.cardImgSelector),S=c.querySelector(t.cardLikeSelector),_=c.querySelector(t.likeCounterSelector),h=c.querySelector(t.cardDeleteSelector);return m.textContent=e.name,v.setAttribute("src",e.link),v.setAttribute("alt",e.name),f(p,e.likes,r,S,t.likeActiveClass,_),r===o?h.addEventListener("click",(function(){i(e._id).then(c.remove()).catch(a)})):h.classList.add(t.deleteButtonHiddenClass),S.addEventListener("click",(function(){var n=S.classList.contains(t.likeActiveClass);l(e._id,n).then((function(e){f(p,e.likes,r,S,t.likeActiveClass,_)})).catch(a)})),v.addEventListener("click",(function(){s.setAttribute("src",e.link),s.setAttribute("alt",e.name),d.textContent=e.name,n(u)})),c}(t,r,o,c);e.prepend(m)}function v(e){(e.target.classList.contains("popup__close-button")||e.target.classList.contains("popup_opened"))&&r(e.target.closest(".popup"))}var S=document.querySelector(".profile"),_=S.querySelector(".profile__name"),h=S.querySelector(".profile__desc"),y=S.querySelector(".profile__avatar"),b=S.querySelector(".profile__edit-button"),q=document.querySelector("#popup_profile-edit"),E=q.querySelector(".form[name=profile-edit]"),k=E.querySelector("#profile-name"),L=E.querySelector("#profile-desc"),C=E.querySelector(".form__button"),g=S.querySelector(".profile__avatar-edit-button"),A=document.querySelector("#popup_avatar-edit"),x=A.querySelector("form[name=avatar-edit]"),T=x.querySelector("#avatar-link"),U=x.querySelector(".form__button"),B=S.querySelector(".profile__add-button"),D=document.querySelector("#popup_place-add"),N=D.querySelector(".form[name=place-add]"),O=N.querySelector("#place-name"),P=N.querySelector("#place-link"),H=N.querySelector(".form__button"),J=document.querySelector(".places__grid"),M=document.querySelectorAll(".popup"),j={formSelector:".form",inputSelector:".form__input",submitButtonSelector:".form__button",inputErrorMsgSelector:".form__input-error",inactiveButtonClass:"form__button_inactive",inputErrorClass:"form__input_invalid"},w={templateSelector:"#place-template",cardElementSelector:".place",cardTitleSelector:".place__name",cardImgSelector:".place__photo",cardLikeSelector:".place__like-button",cardDeleteSelector:".place__delete-button",likeActiveClass:"place__like-button_active",likeCounterSelector:".place__like-counter",deleteButtonHiddenClass:"place__delete-button_hidden"},I="";function z(e,t){_.textContent=e,h.textContent=t}function F(e,t){var n=t.textContent;t.textContent=e?"Сохранение...":n}function V(t,n,o,c){F(!1,o),r(t),e(o,c.inactiveButtonClass,n)}fetch("".concat(o.baseUrl,"/users/me"),{headers:o.headers}).then(c).then((function(e){var t,n,r;t=e.name,n=e.about,r=e.avatar,z(t,n),y.setAttribute("src",r),I=e._id})).catch(a),fetch("".concat(o.baseUrl,"/cards"),{headers:o.headers}).then(c).then((function(e){e.forEach((function(e){m(J,e,w,I,e.owner._id)}))})).catch(a),b.addEventListener("click",(function(){k.value=_.textContent,L.value=h.textContent,function(e,t){var n=e.querySelectorAll(t.inputErrorMsgSelector),r=e.querySelectorAll(t.inputSelector);n.forEach((function(e){return e.textContent=""})),r.forEach((function(e){return e.classList.remove(t.inputErrorClass)}))}(E,j),n(q)})),M.forEach((function(e){e.addEventListener("click",v)})),B.addEventListener("click",(function(){n(D)})),g.addEventListener("click",(function(){n(A)})),N.addEventListener("submit",(function(e){var t,n;e.preventDefault(),F(!0,H),(t=O.value,n=P.value,fetch("".concat(o.baseUrl,"/cards"),{method:"POST",headers:o.headers,body:JSON.stringify({name:t,link:n})}).then(c)).then((function(e){m(J,e,w,I,I)})).catch(a).finally(V(D,N,H,j)),e.target.reset()})),E.addEventListener("submit",(function(e){var t,n;e.preventDefault(),F(!0,C),(t=k.value,n=L.value,fetch("".concat(o.baseUrl,"/users/me"),{method:"PATCH",headers:o.headers,body:JSON.stringify({name:t,about:n})}).then(c)).then((function(e){z(e.name,e.about)})).catch(a).finally(V(q,E,C,j))})),x.addEventListener("submit",(function(e){var t;e.preventDefault(),F(!0,U),(t=T.value,fetch("".concat(o.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:o.headers,body:JSON.stringify({avatar:t})}).then(c)).then((function(e){return y.setAttribute("src",e.avatar)})).catch(a).finally(V(A,x,U,j))})),function(t){document.querySelectorAll(t.formSelector).forEach((function(n){!function(t,n){var r=t.querySelectorAll(n.inputSelector),o=t.querySelector(n.submitButtonSelector);t.addEventListener("submit",(function(e){e.preventDefault()})),e(o,n.inactiveButtonClass,t),r.forEach((function(r){r.addEventListener("input",(function(c){!function(e,t,n){var r=t.validity.valid,o=e.querySelector("#".concat(t.id,"-error"));r?function(e,t,n){t.textContent=e.validationMessage,e.classList.remove(n)}(t,o,n):function(e,t,n){t.textContent=e.validationMessage,e.classList.add(n)}(t,o,n)}(t,r,n.inputErrorClass),e(o,n.inactiveButtonClass,t)}))}))}(n,t)}))}(j)})();